# 磁盘阵列

- [返回](./README.md)
- 概念

  磁盘阵列（Redundant Arrays of Independent Drives，RAID），有“独立磁盘构成的具有冗余能力的阵列”之意。 磁盘阵列是由很多价格较便宜的磁盘，组合成一个容量巨大的磁盘组，利用个别磁盘提供数据所产生加成效果提升整个磁盘系统效能。利用这项技术，将数据切割成许多区段，分别存 放在各个硬盘上。

  [百度百科](https://baike.baidu.com/item/磁盘阵列/1149823)

- 分类

  磁盘阵列其样式有三种，一是外接式磁盘阵列柜、二是内接式磁盘阵列卡，三是利用软件来仿真。

  外接式磁盘阵列柜最常被使用大型服务器上，具可热交换（Hot Swap）的特性，不过这类产品的价格都很贵。

  内接式磁盘阵列卡，因为价格便宜，但需要较高的安装技术，适合技术人员使用操作。硬件阵列能够提供在线扩容、动态修改阵列级别、自动数据恢复、驱动器漫游、超高速缓冲等功能。它能提供性能、数据保护、可靠性、可用性和可管理性的解决方案。阵列卡专用的处理单元来进行操作。

  利用软件仿真的方式，是指通过网络操作系统自身提供的磁盘管理功能将连接的普通 SCSI 卡上的多块硬盘配置成逻辑盘，组成阵列。软件阵列可以提供数据冗余功能，但是磁盘子系统的性能会有所降低，有的降低幅度还比较大，达 30%左右。因此会拖累机器的速度，不适合大数据流量的服务器。

- RAID 级别

  - RAID 0

    RAID 0 是最早出现的 RAID 模式，即 Data Stripping 数据分条技术。RAID 0 是组建磁盘阵列中最简单的一种形式，只需要 2 块以上的硬盘即可，成本低，可以提高整个磁盘的性能和吞吐量。RAID 0 没有提供冗余或错误修复能力，但实现成本是最低的。

    RAID 0 最简单的实现方式就是把 N 块同样的硬盘用硬件的形式通过智能磁盘控制器或用操作系统中的磁盘驱动程序以软件的方式串联在一起创建一个大的卷集。在使用中电脑数据依次写入到各块硬盘中，它的最大优点就是可以整倍的提高硬盘的容量。如使用了三块 80GB 的硬盘组建成 RAID 0 模式，那么磁盘容量就会是 240GB。其速度方面，各单独一块硬盘的速度完全相同。最大的缺点在于任何一块硬盘出现故障，整个系统将会受到破坏，可靠性仅为单独一块硬盘的 1/N。

  - RAID 1

    RAID 1 称为磁盘镜像，原理是把一个磁盘的数据镜像到另一个磁盘上，也就是说数据在写入一块磁盘的同时，会在另一块闲置的磁盘上生成镜像文件，在不影响性能情况下最大限度的保证系统的可靠性和可修复性上，只要系统中任何一对镜像盘中至少有一块磁盘可以使用，甚至可以在一半数量的硬盘出现问题时系统都可以正常运行,当一块硬盘失效时，系统会忽略该硬盘，转而使用剩余的镜像盘读写数据，具备很好的磁盘冗余能力。虽然这样对数据来讲绝对安全，但是成本也会明显增加，磁盘利用率为 50%，以四块 80GB 容量的硬盘来讲，可利用的磁盘空间
    仅为 160GB。另外，出现硬盘故障的 RAID 系统不再可靠，应当及时的更换损坏的硬盘，否则剩余的镜像盘也出现问题，那么整个系统就会崩溃。更换新盘后原有数据会需要很长时间同步镜像，外界对数据的访问不会受到影响，只是这时整个系统的性能有所下降。因此，RAID 1 多用在保存关键性的重要数据的场合。

- 与 LVM 区别

  RAID 主要是物理盘的冗余备份防止物理盘损坏;

  LVM 主要是逻辑卷管理，更好的使用磁盘;

  [LVM 和 RAID](https://www.cnblogs.com/liuyuanq/p/10014811.html)

---

## RAID:

```
Redundant Arrays of Inexpensive Disks
                    Independent

Berkeley: A case for Redundent Arrays of Inexpensive Disks RAID

    提高IO能力：
        磁盘并行读写；
    提高耐用性；
        磁盘冗余来实现

    级别：多块磁盘组织在一起的工作方式有所不同；
    RAID实现的方式：
        外接式磁盘阵列：通过扩展卡提供适配能力
        内接式RAID：主板集成RAID控制器
        Software RAID：

级别：level
    RAID-0：0, 条带卷，strip;
    RAID-1: 1, 镜像卷，mirror;
    RAID-2
    ..
    RAID-5：
    RAID-6
    RAID10
    RAID01

    RAID-0: 以条带形式将数据均匀分布在阵列的各个磁盘上；
        读、写性能提升；
        可用空间：N*min(S1,S2,...)
        无容错能力
        最少磁盘数：2, 2+
        适用领域：视频生成和编辑、图形编辑，其它需要大的传输带宽的操作；

    RAID-1：以镜像为冗余方式，对虚拟磁盘上的数据做多份拷贝，放在成员磁盘上
        读性能提升、写性能略有下降；
        可用空间：1*min(S1,S2,...)
        有冗余能力
        最少磁盘数：2, 2+
        适用领域：财务、金融等高可用、高安全的数据存储环境

    RAID-4：数据交叉存储在2块硬盘中，再由第3块硬盘存储数据的校验码；
        1101, 0110, 1011

    RAID-5：采用独立存取的阵列方式，校验信息被均匀的分散到阵列的各个磁盘上；
        读、写性能提升
        可用空间：(N-1)*min(S1,S2,...)
        有容错能力：1块磁盘
        最少磁盘数：3, 3+
        适用领域：文件服务器、email服务器、web服务器等环境，数据库应用
    RAID-6：用2块盘做校验盘，校验码存两次；
        读、写性能提升
        可用空间：(N-2)*min(S1,S2,...)
        有容错能力：2块磁盘
        最少磁盘数：4, 4+


    混合类型
        RAID-10：结合RAID1和RAID0，先镜像，再条带化；
            读、写性能提升
            可用空间：N*min(S1,S2,...)/2
            有容错能力：每组镜像最多只能坏一块；
            磁盘数：2n(n>=2)
            优点：读性能很高，写性能比较好，数据安全性好，允许同时有N个磁盘失效；
            缺点：利用率只有50%，开销大；
            适用领域：多用于要求高可用性和高安全性的数据库应用；
        RAID-01:先分成两组做成RAID-0，再把组成的RAID-0做成RAID-1；不符合常用方法，每一组有一块坏的硬盘可能性大；

        RAID-50、RAID7
            适用领域：大型数据库服务器、应用服务器、文件服务器等应用；
        JBOD：Just a Bunch Of Disks
            功能：将多块磁盘的空间合并一个大的连续空间使用；
            可用空间：sum(S1+S2+,...)

    常用级别：
            RAID-0 性能最好
            RAID-1 冗余度最高,开销高
            RAID-5
            RAID-10 开销高
            RAID-50
            JBOD

    实现方式：
        硬件实现方式
        软件实现方式

        CentOS 6上的软件RAID的实现：
            结合内核中的md(multi devices)

            mdadm：模式化的工具
                命令的语法格式：mdadm [mode] <raiddevice> [options] <component-devices>
                    支持的RAID级别：LINEAR, RAID0, RAID1, RAID4, RAID5, RAID6, RAID10;

                模式：
                    创建：-C
                    装配: -A
                    监控: -F
                    管理：-f, -r, -a

                <raiddevice>: /dev/md#
                <component-devices>: 任意块设备


                -C: 创建模式
                    -n #: 使用#个块设备来创建此RAID；
                    -l #：指明要创建的RAID的级别；
                    -a {yes|no}：自动创建目标RAID设备的设备文件；
                    -c CHUNK_SIZE: 指明块大小；(默认512k)
                    -x #: 指明空闲盘的个数；

                    例如：创建一个#G可用空间的RAID5；
                        [root@study ~]# mdadm -C /dev/md0 -n 3 -x 1 -a yes -l 5 /dev/sdb{5,6,7,8}
                        [root@study ~]# mke2fs -t ext4 /dev/md0
                        [root@study /]# mount /dev/md0 /mydata
                        [root@study /]# mdadm -D /dev/md0

                -D：显示raid的详细信息；
                    mdadm -D /dev/md#

                管理模式：
                    -f: 标记指定磁盘为损坏；
                    -a: 添加磁盘
                    -r: 移除磁盘

                观察md的状态：
                    cat /proc/mdstat

                -S: 停止md设备
                    mdadm -S /dev/md#

            watch命令：
                -n #: 刷新间隔，单位是秒；

                watch -n# 'COMMAND'
```

---
