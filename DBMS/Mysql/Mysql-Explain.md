# MySQL 优化 explain 的使用

## explain 的各个参数的指标说明

- id

- select_type (查询类型)

- table (表)

  显示这一行的数据是关于哪张表的

- partitions (分区)

- type (类型)

  这是重要的列，显示连接使用了何种类型。从最好到最差的连接类型为 const、eq_reg、ref、range、index 和 ALL

  type 显示的是访问类型，是较为重要的一个指标;

  结果值从好到坏依次是：

  `system > const > eq_ref > ref > fulltext > ref_or_null > index_merge > unique_subquery > index_subquery > range > index > ALL`

  一般来说，得保证查询至少达到 range 级别，最好能达到 ref。

- possible_keys

  显示可能应用在这张表中的索引。如果为空，没有可能的索引。可以为相关的域从 WHERE 语句中选择一个合适的语句

- key (索引)

  实际使用的索引。如果为 NULL，则没有使用索引。很少的情况下，MYSQL 会选择优化不足的索引。这种情况下，可以在 SELECT 语句中使用 USE INDEX（indexname）来强制使用一个索引或者用 IGNORE INDEX（indexname）来强制 MYSQL 忽略索引

- key_len (索引长度)

  使用的索引的长度。在不损失精确性的情况下，长度越短越好

- ref

  显示索引的哪一列被使用了，如果可能的话，是一个常数

- rows (行数)

  MYSQL 认为必须检查的用来返回请求数据的行数

- filtered (过滤)

- Extra (额外信息)

  关于 MYSQL 如何解析查询的额外信息。将在表 4.3 中讨论，但这里可以看到的坏的例子是 Using temporary 和 Using filesort，意思 MYSQL 根本不能使用索引，结果是检索会很慢

## 图标说明

| 字段          | 字段说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| id            | SELECT 识别符。这是 SELECT 的查询序列号                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| select_type   | SELECT 类型,可以为以下任何一种:<br>SIMPLE:简单 SELECT(不使用 UNION 或子查询)<br>PRIMARY:最外面的 SELECT<br>UNION:UNION 中的第二个或后面的 SELECT 语句<br>DEPENDENT UNION:UNION 中的第二个或后面的 SELECT 语句,取决于外面的查询<br>UNION RESULT:UNION 的结果<br>SUBQUERY:子查询中的第一个 SELECT<br>DEPENDENT SUBQUERY:子查询中的第一个 SELECT,取决于外面的查询<br>DERIVED:导出表的 SELECT(FROM 子句的子查询)<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| table         | 输出的行所引用的表                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| type          | 联接类型。下面给出各种联接类型,按照从最佳类型到最坏类型进行排序:<br>system:表仅有一行(=系统表)。这是 const 联接类型的一个特例。<br>const:表最多有一个匹配行,它将在查询开始时被读取。因为仅有一行,在这行的列值可被优化器剩余部分认为是常数。const 表很快,因为它们只读取一次!<br>eq_ref:对于每个来自于前面的表的行组合,从该表中读取一行。这可能是最好的联接类型,除了 const 类型。<br>ref:对于每个来自于前面的表的行组合,所有有匹配索引值的行将从这张表中读取。<br>ref_or_null:该联接类型如同 ref,但是添加了 MySQL 可以专门搜索包含 NULL 值的行。<br>index_merge:该联接类型表示使用了索引合并优化方法。<br>unique_subquery:该类型替换了下面形式的 IN 子查询的 ref: value IN (SELECT primary_key FROM single_table WHERE some_expr) unique_subquery 是一个索引查找函数,可以完全替换子查询,效率更高。<br>index_subquery:该联接类型类似于 unique_subquery。可以替换 IN 子查询,但只适合下列形式的子查询中的非唯一索引: value IN (SELECT key_column FROM single_table WHERE some_expr)<br>range:只检索给定范围的行,使用一个索引来选择行。<br>index:该联接类型与 ALL 相同,除了只有索引树被扫描。这通常比 ALL 快,因为索引文件通常比数据文件小。<br>ALL:对于每个来自于先前的表的行组合,进行完整的表扫描。<br> |
| possible_keys | 指出 MySQL 能使用哪个索引在该表中找到行                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| key           | 显示 MySQL 实际决定使用的键(索引)。如果没有选择索引,键是 NULL。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| key_len       | 显示 MySQL 决定使用的键长度。如果键是 NULL,则长度为 NULL。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ref           | 显示使用哪个列或常数与 key 一起从表中选择行。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| rows          | 显示 MySQL 认为它执行查询时必须检查的行数。多行之间的数据相乘可以估算要处理的行数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| filtered      | 显示了通过条件过滤出的行数的百分比估计值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Extra         | 该列包含 MySQL 解决查询的详细信息<br>Distinct:MySQL 发现第 1 个匹配行后,停止为当前的行组合搜索更多的行。<br>Not exists:MySQL 能够对查询进行 LEFT JOIN 优化,发现 1 个匹配 LEFT JOIN 标准的行后,不再为前面的的行组合在该表内检查更多的行。<br>range checked for each record (index map: #):MySQL 没有发现好的可以使用的索引,但发现如果来自前面的表的列值已知,可能部分索引可以使用。<br>Using filesort:MySQL 需要额外的一次传递,以找出如何按排序顺序检索行。<br>Using index:从只使用索引树中的信息而不需要进一步搜索读取实际的行来检索表中的列信息。<br>Using temporary:为了解决查询,MySQL 需要创建一个临时表来容纳结果。<br>Using where:WHERE 子句用于限制哪一个行匹配下一个表或发送到客户。<br>Using sort_union(...), Using union(...), Using intersect(...):这些函数说明如何为 index_merge 联接类型合并索引扫描。<br>Using index for group-by:类似于访问表的 Using index 方式,Using index for group-by 表示 MySQL 发现了一个索引,可以用来查 询 GROUP BY 或 DISTINCT 查询的所有列,而不要额外搜索硬盘访问实际的表。                                                                                                                                                                                  |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
